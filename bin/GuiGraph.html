<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>GUI</title>
	</head>

	<body>
	<h1>1 BFS TREE:</h1>
	<svg width="5000" height="2000">
	<line x1="760" y1="260" x2="670" y2="380" id="31_11" style="stroke:black;stroke-width:1"/>
	<line x1="670" y1="380" x2="310" y2="500" id="11_21" style="stroke:black;stroke-width:1"/>
	<line x1="1120" y1="140" x2="760" y2="260" id="71_31" style="stroke:black;stroke-width:1"/>
	<line x1="310" y1="500" x2="130" y2="620" id="21_41" style="stroke:black;stroke-width:1"/>
	<line x1="310" y1="500" x2="490" y2="620" id="21_51" style="stroke:black;stroke-width:1"/>
	<line x1="760" y1="260" x2="940" y2="380" id="31_61" style="stroke:black;stroke-width:1"/>
	<line x1="1300" y1="20" x2="1120" y2="140" id="141_71" style="stroke:black;stroke-width:1"/>
	<line x1="130" y1="620" x2="40" y2="740" id="41_81" style="stroke:black;stroke-width:1"/>
	<line x1="130" y1="620" x2="220" y2="740" id="41_91" style="stroke:black;stroke-width:1"/>
	<line x1="490" y1="620" x2="400" y2="740" id="51_101" style="stroke:black;stroke-width:1"/>
	<line x1="490" y1="620" x2="580" y2="740" id="51_111" style="stroke:black;stroke-width:1"/>
	<line x1="940" y1="380" x2="850" y2="500" id="61_121" style="stroke:black;stroke-width:1"/>
	<line x1="940" y1="380" x2="1030" y2="500" id="61_131" style="stroke:black;stroke-width:1"/>
	<line x1="1120" y1="140" x2="1210" y2="260" id="71_151" style="stroke:black;stroke-width:1"/>
	<g>
		<rect width="80" height="40" x="630" y="360" id="1 " rx="10" ry="10" fill="orange"/>
		<text id="Text1 "x="667" y="383" fill="black" font-size="12">1 </text>
	</g>
	<g>
		<rect width="80" height="40" x="270" y="480" id="2 " rx="10" ry="10" fill="orange"/>
		<text id="Text2 "x="307" y="503" fill="black" font-size="12">2 </text>
	</g>
	<g>
		<rect width="80" height="40" x="720" y="240" id="3 " rx="10" ry="10" fill="orange"/>
		<text id="Text3 "x="757" y="263" fill="black" font-size="12">3 </text>
	</g>
	<g>
		<rect width="80" height="40" x="90" y="600" id="4 " rx="10" ry="10" fill="orange"/>
		<text id="Text4 "x="127" y="623" fill="black" font-size="12">4 </text>
	</g>
	<g>
		<rect width="80" height="40" x="450" y="600" id="5 " rx="10" ry="10" fill="orange"/>
		<text id="Text5 "x="487" y="623" fill="black" font-size="12">5 </text>
	</g>
	<g>
		<rect width="80" height="40" x="900" y="360" id="6 " rx="10" ry="10" fill="orange"/>
		<text id="Text6 "x="937" y="383" fill="black" font-size="12">6 </text>
	</g>
	<g>
		<rect width="80" height="40" x="1080" y="120" id="7 " rx="10" ry="10" fill="orange"/>
		<text id="Text7 "x="1117" y="143" fill="black" font-size="12">7 </text>
	</g>
	<g>
		<rect width="80" height="40" x="0" y="720" id="8 " rx="10" ry="10" fill="orange"/>
		<text id="Text8 "x="37" y="743" fill="black" font-size="12">8 </text>
	</g>
	<g>
		<rect width="80" height="40" x="180" y="720" id="9 " rx="10" ry="10" fill="orange"/>
		<text id="Text9 "x="217" y="743" fill="black" font-size="12">9 </text>
	</g>
	<g>
		<rect width="80" height="40" x="360" y="720" id="10 " rx="10" ry="10" fill="orange"/>
		<text id="Text10 "x="394" y="743" fill="black" font-size="12">10 </text>
	</g>
	<g>
		<rect width="80" height="40" x="540" y="720" id="11 " rx="10" ry="10" fill="orange"/>
		<text id="Text11 "x="574" y="743" fill="black" font-size="12">11 </text>
	</g>
	<g>
		<rect width="80" height="40" x="810" y="480" id="12 " rx="10" ry="10" fill="orange"/>
		<text id="Text12 "x="844" y="503" fill="black" font-size="12">12 </text>
	</g>
	<g>
		<rect width="80" height="40" x="990" y="480" id="13 " rx="10" ry="10" fill="orange"/>
		<text id="Text13 "x="1024" y="503" fill="black" font-size="12">13 </text>
	</g>
	<g>
		<rect width="80" height="40" x="1260" y="0" id="14 " rx="10" ry="10" fill="orange"/>
		<text id="Text14 "x="1294" y="23" fill="black" font-size="12">14 </text>
	</g>
	<g>
		<rect width="80" height="40" x="1170" y="240" id="15 " rx="10" ry="10" fill="orange"/>
		<text id="Text15 "x="1204" y="263" fill="black" font-size="12">15 </text>
	</g>
	</svg>

	<input type="button" value="Start" onclick="startAnimation()"/>
	<input type="button" value="Step" onclick="stepAnimation()" />
	<input type="button" value="Stop" onclick="stopAnimation()" />
	<h1>2 GRAPH:</h1>
	<svg width="5000" height="3000">

	<line x1="960" y1="480" x2="920" y2="667" id="1_2" style="stroke:black;stroke-width:1"/>
	<line x1="960" y1="480" x2="808" y2="822" id="1_3" style="stroke:black;stroke-width:1"/>
	<line x1="920" y1="667" x2="642" y2="917" id="2_4" style="stroke:black;stroke-width:1"/>
	<line x1="920" y1="667" x2="452" y2="937" id="2_5" style="stroke:black;stroke-width:1"/>
	<line x1="808" y1="822" x2="270" y2="878" id="3_6" style="stroke:black;stroke-width:1"/>
	<line x1="808" y1="822" x2="128" y2="750" id="3_7" style="stroke:black;stroke-width:1"/>
	<line x1="642" y1="917" x2="50" y2="576" id="4_8" style="stroke:black;stroke-width:1"/>
	<line x1="642" y1="917" x2="50" y2="384" id="4_9" style="stroke:black;stroke-width:1"/>
	<line x1="452" y1="937" x2="128" y2="210" id="5_10" style="stroke:black;stroke-width:1"/>
	<line x1="452" y1="937" x2="270" y2="82" id="5_11" style="stroke:black;stroke-width:1"/>
	<line x1="270" y1="878" x2="452" y2="23" id="6_12" style="stroke:black;stroke-width:1"/>
	<line x1="270" y1="878" x2="642" y2="43" id="6_13" style="stroke:black;stroke-width:1"/>
	<line x1="128" y1="750" x2="808" y2="138" id="7_14" style="stroke:black;stroke-width:1"/>
	<line x1="128" y1="750" x2="920" y2="293" id="7_15" style="stroke:black;stroke-width:1"/>
	<g>
		<rect width="80" height="40" x="920" y="460" id="1" rx="10" ry="10" fill="orange"/>
		<text id="Text1"x="960" y="483" fill="black" font-size="12">1</text>
	</g>
	<g>
		<rect width="80" height="40" x="880" y="647" id="2" rx="10" ry="10" fill="orange"/>
		<text id="Text2"x="920" y="670" fill="black" font-size="12">2</text>
	</g>
	<g>
		<rect width="80" height="40" x="768" y="802" id="3" rx="10" ry="10" fill="orange"/>
		<text id="Text3"x="808" y="825" fill="black" font-size="12">3</text>
	</g>
	<g>
		<rect width="80" height="40" x="602" y="897" id="4" rx="10" ry="10" fill="orange"/>
		<text id="Text4"x="642" y="920" fill="black" font-size="12">4</text>
	</g>
	<g>
		<rect width="80" height="40" x="412" y="917" id="5" rx="10" ry="10" fill="orange"/>
		<text id="Text5"x="452" y="940" fill="black" font-size="12">5</text>
	</g>
	<g>
		<rect width="80" height="40" x="230" y="858" id="6" rx="10" ry="10" fill="orange"/>
		<text id="Text6"x="270" y="881" fill="black" font-size="12">6</text>
	</g>
	<g>
		<rect width="80" height="40" x="88" y="730" id="7" rx="10" ry="10" fill="orange"/>
		<text id="Text7"x="128" y="753" fill="black" font-size="12">7</text>
	</g>
	<g>
		<rect width="80" height="40" x="10" y="556" id="8" rx="10" ry="10" fill="orange"/>
		<text id="Text8"x="50" y="579" fill="black" font-size="12">8</text>
	</g>
	<g>
		<rect width="80" height="40" x="10" y="364" id="9" rx="10" ry="10" fill="orange"/>
		<text id="Text9"x="50" y="387" fill="black" font-size="12">9</text>
	</g>
	<g>
		<rect width="80" height="40" x="88" y="190" id="10" rx="10" ry="10" fill="orange"/>
		<text id="Text10"x="125" y="213" fill="black" font-size="12">10</text>
	</g>
	<g>
		<rect width="80" height="40" x="230" y="62" id="11" rx="10" ry="10" fill="orange"/>
		<text id="Text11"x="267" y="85" fill="black" font-size="12">11</text>
	</g>
	<g>
		<rect width="80" height="40" x="412" y="3" id="12" rx="10" ry="10" fill="orange"/>
		<text id="Text12"x="449" y="26" fill="black" font-size="12">12</text>
	</g>
	<g>
		<rect width="80" height="40" x="602" y="23" id="13" rx="10" ry="10" fill="orange"/>
		<text id="Text13"x="639" y="46" fill="black" font-size="12">13</text>
	</g>
	<g>
		<rect width="80" height="40" x="768" y="118" id="14" rx="10" ry="10" fill="orange"/>
		<text id="Text14"x="805" y="141" fill="black" font-size="12">14</text>
	</g>
	<g>
		<rect width="80" height="40" x="880" y="273" id="15" rx="10" ry="10" fill="orange"/>
		<text id="Text15"x="917" y="296" fill="black" font-size="12">15</text>
	</g>
	</svg>

<script>
	const lineNameIds = [ "1_2", "1_3", "2_4", "2_5", "3_6", "3_7", "4_8", "4_9", "5_10", "5_11", "6_12", "6_13", "7_14", "7_15"]
	const pointNameIds = [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15"]
	const textNames = [ "Text1", "Text2", "Text3", "Text4", "Text5", "Text6", "Text7", "Text8", "Text9", "Text10", "Text11", "Text12", "Text13", "Text14", "Text15"]
	
	    lineObjs = [];
		initialObjPosX = [];
		initialObjSpeedX = [];
		TextObjs = [];
		initialObjSpeedY = [];
		
		lineNameIds.forEach((n) => lineObjs.push(document.getElementById(n)));
		pointNameIds.forEach((n) => initialObjPosX.push(document.getElementById(n)));
		textNames.forEach((n) => TextObjs.push(document.getElementById(n)));
		
		pointNameIds.forEach((n) => initialObjSpeedX.push(0.0));
		pointNameIds.forEach((n) => initialObjSpeedY.push(0.0));
		
		
		const m = 10;
		const mu = 10;
		const k_spring = 1.3*mu;
	    const k_repulse = -3.3*mu;
		const dt = 0.001;
		const restDistance = 300;
		
		const atan3 = (x, y) => {
			if (x >= 0){
				return Math.atan(y/x);
			} else if (x * y <= 0){
				return Math.atan(y/x) + Math.PI;
			} else if (x < 0){
				return Math.atan(y/x) - Math.PI;
			}
		}
	
		const calculateSpringForce = (name, fromX, toSpringXs, fromY, toSpringYs, isXcoordinate) => {
			displacementForces = [];
		    toSpringXs.forEach((toX, i) => {
				displacement = 0;
				toY = toSpringYs[i];
	
				offsetY = toY-fromY;
				offsetX = toX-fromX;
	
				radians = Math.atan2(offsetY, offsetX);
	
				actualRestDistance = restDistance * (isXcoordinate ? Math.cos(radians) : Math.sin(radians));
				
				displacement = (fromX  - toX + actualRestDistance)
	
				console.log(name + " Offset: (" + Math.round(offsetX) + ", " + Math.round(offsetY) , ") " + " Dis: " + Math.round(actualRestDistance) + " Deg: "+ radians*180/Math.PI + " Displacement" + displacement)
				displacementForces.push(displacement);
		    })
			
			return displacementForces.reduce((partialSumForce, otherForce) => partialSumForce + otherForce, 0)*-1;
		}
	
		const calculateAcceleration = (fromX, speedX, toXs, isXcoordinate, fromY, toSpringY, repXs, repY) => {
		    
	        repulsionForces = [];
		    console.log("From: " + Math.abs(fromX), " To's: " +toXs)
			displacement = 0;
			repulsionForce = 0;
			
			repulsion = 0;
	        // //Repulsion
	        repXs.forEach((repX, i)=>{
	            repulsion = 0;
				offsetY = repY[i]-fromY;
				offsetX = repX-fromX;
				r = Math.sqrt(offsetX**2 +  offsetY**2)
				radians = Math.atan2(offsetY, offsetX);
	            
	            
	            if (offsetX === 0){
	            	repulsion = 1;
	            } else {
	            	repulsion = k_repulse*-1*offsetX / (r)
	
	            }
	
	            repulsionForces.push(repulsion);
	        })
	
	
		    
		    springForce =  calculateSpringForce("Node: ", fromX, toXs, fromY, toSpringY, isXcoordinate);
	        repulsionForce = repulsionForces.reduce((partialSumForce, otherForce) => partialSumForce + otherForce, 0); 
		    console.log("Spring Force: " + springForce)
			console.log("Acceleation: " + ((k_spring*springForce) + k_repulse*repulsionForce + -1*mu*speedX)/m)
			return ((k_spring*springForce) + k_repulse*repulsionForce + mu*2*(Math.random()*2 - 1) + -1*mu*speedX)/m;
		}
		
		
		var oldPositionsX = [];
		var oldPositionsY = [];
		var oldVelocitiesX = [...initialObjSpeedX];
		var newVelocitiesX = [...initialObjSpeedX];
		
		var oldVelocitiesY = [...initialObjSpeedY];
		var newVelocitiesY = [...initialObjSpeedY];
		var springPointsX = [];
	    var springPointsY = [];
		var newAccelerationX, newAccelerationY;
		var newPosX, newPosY;
		var newSpeedX, newSpeedY;
		var initObjPosX = []
		var initObjPosY = []
		initialObjPosX.forEach((pointObj, i) =>{
		    oldPositionsX.push((pointObj.getAttribute("x")));
			initObjPosX.push(pointObj.getAttribute("x"));
		})
		initialObjPosX.forEach((pointObj, i) =>{
		    oldPositionsY.push((pointObj.getAttribute("y")));
			initObjPosY.push(pointObj.getAttribute("y"));
		})
		var newPositionsX = [...oldPositionsX];
		var newPositionsY = [...oldPositionsY];
	
		let otherPointindex, connections, conntected;
		
		const restPoint = 300; 
		function animate() {
			console.clear()
		    springPointsX = [];
		    springPointsY = [];
	        
		    oldVelocitiesX = [];
		    oldPositionsX = [];
		    oldVelocitiesY = [];
		    oldPositionsY = [];
	
		    oldVelocitiesX = [...newVelocitiesX];
		    oldPositionsX = [...newPositionsX];
		    oldVelocitiesY = [...newVelocitiesY];
		    oldPositionsY = [...newPositionsY];
		
		    oldPositionsX.forEach((oldPosX, i) =>{
				oldPosY = oldPositionsY[i];
		        parent = pointNameIds[i];
		        springPointsX = [restPoint];
				springPointsY = [restPoint];
		        conntected = []
		        
		        lineNameIds.forEach((name) => {
		            connections = []
		            connections = name.split("_");
		            
		            if (connections[0] === parent) {
		                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[1]));
		                conntected.push(pointNameIds[otherPointindex]);
		                springPointsX.push(oldPositionsX[otherPointindex]);
						springPointsY.push(oldPositionsY[otherPointindex]);
		            } else if (connections[1] === parent) {
		                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[0]));
		                conntected.push(pointNameIds[otherPointindex]);
		                springPointsX.push(oldPositionsX[otherPointindex]);
						springPointsY.push(oldPositionsY[otherPointindex]);
		            }
		        })
	            
				repX = [restPoint,...oldPositionsX];
				repY = [restPoint,...oldPositionsY];
	
		        newAccelerationX = calculateAcceleration(+oldPosX, +oldVelocitiesX[i], springPointsX, true, +oldPosY, springPointsY, repX, repY);
		        newPosX = +oldPosX + (+oldVelocitiesX[i] * dt);
		        newSpeedX = (+oldVelocitiesX[i] + newAccelerationX * dt);
		        newSpeedX = Math.abs(newSpeedX) > 0.00001 ? newSpeedX : 0;
	
				newAccelerationY = calculateAcceleration(+oldPosY, +oldVelocitiesY[i], springPointsY, false, +oldPosX, springPointsX,  repX, repY);
		        newPosY = +oldPosY + (+oldVelocitiesY[i] * dt);
		        newSpeedY = (+oldVelocitiesY[i] + newAccelerationY * dt);
		        newSpeedY = Math.abs(newSpeedY) > 0.00001 ? newSpeedY : 0;
		
		
		        console.log(parent,"AccX:", newAccelerationX, newAccelerationY);
		        console.log(parent,"VelX:", oldVelocitiesX[i], newSpeedX, oldVelocitiesY[i], newSpeedY);
		        console.log(parent,"PosX:", oldPosX, newPosX, oldPosY, newPosY);
		        newPositionsX[i] = (newPosX);
		        newVelocitiesX[i] = newSpeedX;
				newPositionsY[i] = (newPosY);
		        newVelocitiesY[i] = newSpeedY;
		    })
		    
		
		    initialObjPosX.forEach((pointObj, i) => {
		        pointObj.setAttribute("x", Math.abs(newPositionsX[i]));
				pointObj.setAttribute("y", Math.abs(newPositionsY[i]));
		    })
		
		    TextObjs.forEach((textObj, i) => {
		        textObj.setAttribute("x", Math.abs(newPositionsX[i])+20);
		        textObj.setAttribute("y", Math.abs(newPositionsY[i])+40);
		    })
		
		    lineNameIds.forEach((name, i) => {
		        connections = name.split("_");
		        lineObjs[i].setAttribute("x1", Math.abs(newPositionsX[pointNameIds.findIndex((name)=> name==connections[0])])+40);
		        lineObjs[i].setAttribute("x2", Math.abs(newPositionsX[pointNameIds.findIndex((name)=> name==connections[1])])+40 );
		        lineObjs[i].setAttribute("y1", Math.abs(newPositionsY[pointNameIds.findIndex((name)=> name==connections[0])])+30);
		        lineObjs[i].setAttribute("y2", Math.abs(newPositionsY[pointNameIds.findIndex((name)=> name==connections[1])])+30 );
		    })
		    
		
		};
		
		var t = null;
		
		function startAnimation() {
		    if(t == null) {
		      t = setInterval(animate, 1);
		    }
		  }
		  
		function stepAnimation(){
		    animate();
		}
		
		function stopAnimation() {
		    if (t != null) {
		        clearInterval(t);
		        t = null;
				
		    }
		}
	
	(null)</script>
	</body>
</html>
