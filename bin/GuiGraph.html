<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>GUI</title>
	</head>

	<body>
	<h1>OUTPUT:</h1>
	<svg width="1000" height="1000">

	<line x1="960" y1="490" x2="872" y2="760" id="Acheron_BlackSwan" style="stroke:black;stroke-width:5"/>
	<line x1="960" y1="490" x2="128" y2="220" id="Acheron_Sparkle" style="stroke:black;stroke-width:5"/>
	<line x1="960" y1="490" x2="358" y2="53" id="Acheron_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="960" y1="490" x2="642" y2="53" id="Acheron_Zundamon" style="stroke:black;stroke-width:5"/>
	<line x1="872" y1="760" x2="128" y2="220" id="BlackSwan_Sparkle" style="stroke:black;stroke-width:5"/>
	<line x1="872" y1="760" x2="358" y2="53" id="BlackSwan_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="642" y1="927" x2="358" y2="927" id="Bronya_FuXuan" style="stroke:black;stroke-width:5"/>
	<line x1="642" y1="927" x2="128" y2="760" id="Bronya_RuanMei" style="stroke:black;stroke-width:5"/>
	<line x1="642" y1="927" x2="358" y2="53" id="Bronya_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="128" y1="760" x2="358" y2="53" id="RuanMei_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="128" y1="760" x2="872" y2="220" id="RuanMei_Metan" style="stroke:black;stroke-width:5"/>
	<line x1="40" y1="490" x2="358" y2="927" id="SilverWolf_FuXuan" style="stroke:black;stroke-width:5"/>
	<line x1="40" y1="490" x2="358" y2="53" id="SilverWolf_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="128" y1="220" x2="358" y2="53" id="Sparkle_Topaz" style="stroke:black;stroke-width:5"/>
	<line x1="358" y1="53" x2="358" y2="927" id="Topaz_FuXuan" style="stroke:black;stroke-width:5"/>
	<line x1="642" y1="53" x2="872" y2="220" id="Zundamon_Metan" style="stroke:black;stroke-width:5"/>
	<g>
		<rect width="80" height="60" x="920" y="460" id="Acheron" rx="10" ry="10" fill="orange"/>
		<text id="TextAcheron"x="942" y="493" fill="black" font-size="12">Acheron</text>
	</g>
	<g>
		<rect width="80" height="60" x="832" y="730" id="BlackSwan" rx="10" ry="10" fill="orange"/>
		<text id="TextBlackSwan"x="848" y="763" fill="black" font-size="12">BlackSwan</text>
	</g>
	<g>
		<rect width="80" height="60" x="602" y="897" id="Bronya" rx="10" ry="10" fill="orange"/>
		<text id="TextBronya"x="627" y="930" fill="black" font-size="12">Bronya</text>
	</g>
	<g>
		<rect width="80" height="60" x="318" y="897" id="FuXuan" rx="10" ry="10" fill="orange"/>
		<text id="TextFuXuan"x="343" y="930" fill="black" font-size="12">FuXuan</text>
	</g>
	<g>
		<rect width="80" height="60" x="88" y="730" id="RuanMei" rx="10" ry="10" fill="orange"/>
		<text id="TextRuanMei"x="110" y="763" fill="black" font-size="12">RuanMei</text>
	</g>
	<g>
		<rect width="80" height="60" x="0" y="460" id="SilverWolf" rx="10" ry="10" fill="orange"/>
		<text id="TextSilverWolf"x="13" y="493" fill="black" font-size="12">SilverWolf</text>
	</g>
	<g>
		<rect width="80" height="60" x="88" y="190" id="Sparkle" rx="10" ry="10" fill="orange"/>
		<text id="TextSparkle"x="110" y="223" fill="black" font-size="12">Sparkle</text>
	</g>
	<g>
		<rect width="80" height="60" x="318" y="23" id="Topaz" rx="10" ry="10" fill="orange"/>
		<text id="TextTopaz"x="346" y="56" fill="black" font-size="12">Topaz</text>
	</g>
	<g>
		<rect width="80" height="60" x="602" y="23" id="Zundamon" rx="10" ry="10" fill="orange"/>
		<text id="TextZundamon"x="621" y="56" fill="black" font-size="12">Zundamon</text>
	</g>
	<g>
		<rect width="80" height="60" x="832" y="190" id="Metan" rx="10" ry="10" fill="orange"/>
		<text id="TextMetan"x="860" y="223" fill="black" font-size="12">Metan</text>
	</g>
	</svg>

<input type="button" value="Start" onclick="startAnimation()"/>
<input type="button" value="Step" onclick="stepAnimation()" />
<input type="button" value="Stop" onclick="stopAnimation()" />
<script>
	const lineNameIds = [ "Acheron_BlackSwan", "Acheron_Sparkle", "Acheron_Topaz", "Acheron_Zundamon", "BlackSwan_Sparkle", "BlackSwan_Topaz", "Bronya_FuXuan", "Bronya_RuanMei", "Bronya_Topaz", "RuanMei_Topaz", "RuanMei_Metan", "SilverWolf_FuXuan", "SilverWolf_Topaz", "Sparkle_Topaz", "Topaz_FuXuan", "Zundamon_Metan"]
	const pointNameIds = [ "Acheron", "BlackSwan", "Bronya", "FuXuan", "RuanMei", "SilverWolf", "Sparkle", "Topaz", "Zundamon", "Metan"]
	const textNames = [ "TextAcheron", "TextBlackSwan", "TextBronya", "TextFuXuan", "TextRuanMei", "TextSilverWolf", "TextSparkle", "TextTopaz", "TextZundamon", "TextMetan"]
	lineObjs = [];
	initialObjPosX = [];
	initialObjSpeedX = [];
	TextObjs = [];
	initialObjSpeedY = [];
	
	lineNameIds.forEach((n) => lineObjs.push(document.getElementById(n)));
	pointNameIds.forEach((n) => initialObjPosX.push(document.getElementById(n)));
	textNames.forEach((n) => TextObjs.push(document.getElementById(n)));
	
	pointNameIds.forEach((n) => initialObjSpeedX.push(0.0));
	pointNameIds.forEach((n) => initialObjSpeedY.push(0.0));
	
	const k = 0.2;
	const m = 10;
	const mu = 30;
	const dt = 0.01;
	const restDistance = 150;
	
	const calculateAcceleration = (position, speed, otherPositions) => {
	    displacementForces = [];
	    console.log(otherPositions)
	    otherPositions.forEach((otherPoint) => {
	
	    if (Math.abs(otherPoint - position) > restDistance) {
	        displacementForces.push(otherPoint - position - restDistance);
	    } else if (Math.abs(otherPoint - position) < restDistance) {
	        displacementForces.push(restDistance + position - otherPoint);
	    } else {
	        displacementForces.push(0);
	    }
	
	    })
	    console.log(displacementForces)
	    var springForce = displacementForces.reduce((partialSumForce, otherForce) => partialSumForce + otherForce, 0); 
	    return ((k*springForce) + -1*mu*speed)/m;
	}
	
	
	var oldPositionsX = [];
	var oldPositionsY = [];
	var oldVelocitiesX = [...initialObjSpeedX];
	var newVelocitiesX = [...initialObjSpeedX];
	
	var oldVelocitiesY = [...initialObjSpeedY];
	var newVelocitiesY = [...initialObjSpeedY];
	var connectedPointsX = [];
	var newAccelerationX, newAccelerationY;
	var newPosX, newPosY;
	var newSpeedX, newSpeedY;
	initialObjPosX.forEach((pointObj, i) =>{
	    oldPositionsX.push((pointObj.getAttribute("x")));
	})
	initialObjPosX.forEach((pointObj, i) =>{
	    oldPositionsY.push((pointObj.getAttribute("y")));
	})
	var newPositionsX = [...oldPositionsX];
	var newPositionsY = [...oldPositionsY]
	let otherPointindex, connections, conntected;
	function animate() {
	
	    connectedPointsX = [];
	    connectedPointsY = [];
	    oldVelocitiesX = [];
	    oldPositionsX = [];
	    oldVelocitiesY = [];
	    oldPositionsY = [];
	    oldVelocitiesX = [...newVelocitiesX];
	    oldPositionsX = [...newPositionsX];
	    oldVelocitiesY = [...newVelocitiesY];
	    oldPositionsY = [...newPositionsY];
	
	    oldPositionsX.forEach((oldPosX, i) =>{
	        var parent = pointNameIds[i];
	        connectedPointsX = [];
	        conntected = []
	        
	        lineNameIds.forEach((name) => {
	            connections = []
	            connections = name.split("_");
	            
	            if (connections[0] === parent) {
	                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[1]));
	                conntected.push(pointNameIds[otherPointindex]);
	                connectedPointsX.push(oldPositionsX[otherPointindex]);
	            } else if (connections[1] === parent) {
	                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[0]));
	                conntected.push(pointNameIds[otherPointindex]);
	                connectedPointsX.push(oldPositionsX[otherPointindex]);
	            }
	        })
	        console.log(parent, conntected);
	        newAccelerationX = calculateAcceleration(+oldPosX, +oldVelocitiesX[i], connectedPointsX);
	        newPosX = +oldPosX + (+oldVelocitiesX[i] * dt);
	        newSpeedX = (+oldVelocitiesX[i] + newAccelerationX * dt);
	        newSpeedX = Math.abs(newSpeedX) > 0.00001 ? newSpeedX : 0;
	
	
	        console.log(parent,"AccX:", 0, newAccelerationX);
	        console.log(parent,"VelX:", oldVelocitiesX[i], newSpeedX)
	        console.log(parent,"PosX:", oldPosX, newPosX);
	        newPositionsX[i] = (newPosX);
	        newVelocitiesX[i] = newSpeedX;
	    })
	
	    oldPositionsY.forEach((oldPosY, i) =>{
	        var parent = pointNameIds[i];
	        connectedPointsY = [];
	        conntected = []
	        
	        lineNameIds.forEach((name) => {
	            connections = []
	            connections = name.split("_");
	            
	            if (connections[0] === parent) {
	                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[1]));
	                conntected.push(pointNameIds[otherPointindex]);
	                connectedPointsY.push(oldPositionsY[otherPointindex]);
	            } else if (connections[1] === parent) {
	                otherPointindex = pointNameIds.findIndex((randomName)=> (randomName === connections[0]));
	                conntected.push(pointNameIds[otherPointindex]);
	                connectedPointsY.push(oldPositionsY[otherPointindex]);
	            }
	        })
	        console.log(parent, conntected);
	        newAccelerationY = calculateAcceleration(+oldPosY, +oldVelocitiesY[i], connectedPointsY);
	        newPosY = +oldPosY + (+oldVelocitiesY[i] * dt);
	        newSpeedY = (+oldVelocitiesY[i] + newAccelerationY * dt);
	        newSpeedY = Math.abs(newSpeedY) > 0.00001 ? newSpeedY : 0;
	        newPositionsY[i] = (newPosY);
	        newVelocitiesY[i] = newSpeedY;
	    })
	
	    initialObjPosX.forEach((pointObj, i) => {
	        pointObj.setAttribute("x", Math.abs(newPositionsX[i]));
	    })
	
	    initialObjPosX.forEach((pointObj, i) => {
	        pointObj.setAttribute("y", Math.abs(newPositionsY[i]));
	    })
	
	    TextObjs.forEach((textObj, i) => {
	        textObj.setAttribute("x", Math.abs(newPositionsX[i])+20);
	        textObj.setAttribute("y", Math.abs(newPositionsY[i])+40);
	    })
	
	    lineNameIds.forEach((name, i) => {
	        connections = name.split("_");
	        lineObjs[i].setAttribute("x1", Math.abs(newPositionsX[pointNameIds.findIndex((name)=> name==connections[0])])+40);
	        lineObjs[i].setAttribute("x2", Math.abs(newPositionsX[pointNameIds.findIndex((name)=> name==connections[1])])+40 );
	        lineObjs[i].setAttribute("y1", Math.abs(newPositionsY[pointNameIds.findIndex((name)=> name==connections[0])])+30);
	        lineObjs[i].setAttribute("y2", Math.abs(newPositionsY[pointNameIds.findIndex((name)=> name==connections[1])])+30 );
	    })
	    
	
	};
	
	var t = null;
	
	function startAnimation() {
	    if(t == null) {
	      t = setInterval(animate, 1);
	    }
	  }
	  
	function stepAnimation(){
	    animate();
	}
	
	function stopAnimation() {
	    if(t != null) {
	        clearInterval(t);
	        t = null;
	    }
	}</script>
	</body>
</html>
